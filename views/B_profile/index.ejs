<link
  rel="stylesheet"
  type="text/css"
  href="\assets\libs\toastr\build\toastr.min.css"
/>
<script src="\js\jquery.js"></script>

<% function getdate(date){ temp = new Date(date); return temp.getHours() + ":" +
temp.getMinutes() + " " +temp.getDate() + "/" + temp.getMonth() + "/" +
temp.getFullYear() } %> <% if(hocvien.embedding != null){ var total = 0;
for(item of log) total += item.totalTime; total = total / 3600; } %>
<!-- start page title -->
<div class="row">
  <div class="col-12">
    <div
      class="page-title-box d-flex align-items-center justify-content-between"
    >
      <h4 class="mb-0 font-size-18">Th√¥ng tin h·ªçc vi√™n <%= hocvien.ten %></h4>

      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item">
            <a href="javascript: void(0);">H·ªì s∆° h·ªçc vi√™n</a>
          </li>
          <li class="breadcrumb-item active">Profile</li>
        </ol>
      </div>
    </div>
  </div>
</div>
<!-- end page title -->

<div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <% if(hocvien.pending) { %>
        <div class="ribbon ribbon-top-left"><span>ƒêang ch·ªù</span></div>
        <% } else if (hocvien.embedding==null){ %>
        <div class="ribbon2 ribbon-top-left"><span>ƒê√£ h·∫πn</span></div>
        <% } else { %>
        <div class="ribbon1 ribbon-top-left"><span>Ho√†n th√†nh</span></div>
        <% } %>

        <div class="invoice-title" style="margin-left: 7%;">
          <h4 class="float-right font-size-16" style="padding: auto;">
            M√£ s·ªë # <%= hocvien.id %>
          </h4>
          <div class="mb-4" style="margin-bottom: 0px;">
            <img src="\assets\images\logo-dark.png" alt="logo" height="50" />
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-md-3" id="avt">
            <div class="avatar-xl mx-auto mb-4">
              <img
                class="rounded-bottom avatar-xl"
                src="/assets/images/users/avatar-7.jpg"
                alt=""
              />
            </div>
            <h3 class="text-lg-center">
              <strong> ‡º∫ <%= hocvien.ten %> ‡ºª</strong>
            </h3>
            <h5 class="text-lg-center">
              <strong><%= hocvien.quocTich %> üáªüá≥</strong>
            </h5>
          </div>
          <style>
            .card {
              margin: auto;
              max-width: 90%;
            }
            .avatar-xl {
              height: 10rem;
              width: 10rem;
              border: 1px solid #c8c8d3;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            }
            #avt {
              border-right: 1px solid #ccc;
            }
          </style>
          <div class="col-md-9">
            <div class="row">
              <div class="col-sm-4">
                <address>
                  <strong>Th√¥ng tin c∆° b·∫£n:</strong><br />
                  H·ªç t√™n: <strong><%= hocvien.ten %></strong><br />
                  Gi·ªõi t√≠nh:
                  <strong><%= hocvien.gioiTinh ? "Nam" : "N·ªØ" %></strong><br />
                  Ng√†y sinh:
                  <strong><%= getdate(hocvien.ngaySinh).split(" ")[1] %></strong
                  ><br />
                  ƒê·ªãa ch·ªâ: <strong><%= hocvien.diaChi %></strong>
                </address>
              </div>
              <div class="col-sm-4">
                <address class="mt-2 mt-sm-0">
                  <strong>Th√¥ng tin CMND / CCCD / H·ªô Chi·∫øu:</strong><br />
                  Qu·ªëc t·ªãch: <strong><%= hocvien.quocTich %></strong><br />
                  M√£ s·ªë: <strong><%= hocvien.cmnd %></strong><br />
                  C·∫•p ng√†y:
                  <strong
                    ><%= getdate(hocvien.ngayCapcmnd).split(" ")[1] %></strong
                  ><br />
                  N∆°i c·∫•p: <strong><%= hocvien.noiCapcmnd %></strong><br />
                  ƒê·ªãa ch·ªâ ƒëƒÉng k√Ω hktt:
                  <strong><%= hocvien.noiDkhktt %></strong>
                </address>
              </div>
              <div class="col-sm-4">
                <address class="mt-2 mt-sm-0">
                  <strong>Th√¥ng tin ƒëƒÉng k√Ω:</strong><br />
                  Lo·∫°i b·∫±ng: <strong><%= hocvien.loaiGplx %></strong><br />
                  ƒêƒÉng k√Ω t√≠ch h·ª£p: <strong>C√≥</strong>
                </address>
                <% if(!hocvien.pending && hocvien.embedding==null){ %>
                <address class="mt-2 mt-sm-0">
                  <strong>Th√¥ng tin l·ªãch h·∫πn:</strong><br />
                  Ng√†y h·∫πn: <strong><%= getdate(hocvien.ngayHen) %></strong
                  ><br />
                  Ghi ch√∫:<strong><%= hocvien.ghiChu %></strong>
                </address>
                <% } %>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-4 mt-3">
                <address>
                  <strong>Th√¥ng tin li√™n h·ªá:</strong><br />
                  S·ªë ƒëi·ªán tho·∫°i: <strong><%= hocvien.sdt %></strong><br />
                  Email: <strong><%= hocvien.email %></strong>
                </address>
              </div>
              <div class="col-sm-8 mt-3">
                <address>
                  <strong>Gi·∫•y t·ªù li√™n quan:</strong><br />
                  <div class="row">
                    <div class="col-md-4">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input
                        input-mini" <%= hocvien.hasGksk ? 'checked' : '' %>
                        readonly>
                        <label class="custom-control-label"
                          >Gi·∫•y kh√°m s·ª©c kh·ªèe</label
                        >
                      </div>
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input
                        input-mini" <%= hocvien.hasSyll ? 'checked' : '' %>
                        readonly>
                        <label class="custom-control-label"
                          >S∆° y·∫øu l√Ω l·ªãch</label
                        >
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input
                        input-mini" <%= hocvien.hasAnh ? 'checked' : '' %>
                        readonly>
                        <label class="custom-control-label">·∫¢nh 3x4</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input
                        input-mini" <%= hocvien.hasDongdangky ? 'checked' : ''
                        %> readonly>
                        <label class="custom-control-label">ƒê∆°n ƒëƒÉng k√Ω</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input
                        input-mini" <%= hocvien.hasCmnd ? 'checked' : '' %>
                        readonly>
                        <label class="custom-control-label"
                          >B·∫£n sao CMND / CCCD / H·ªô chi·∫øu</label
                        >
                      </div>
                    </div>
                  </div>
                </address>
              </div>
            </div>
          </div>
        </div>
        <% if(hocvien.embedding != null && hocvien.idLop != null){ %>
        <hr />
        <div class="row">
          <div class="col-md-6" style="border-right: 1px solid #ccc ;">
            <address class="mt-2 mt-sm-0" style="padding-left:5%;">
              <strong>Th√¥ng tin l·ªõp h·ªçc:</strong><br />
              L·ªõp: <strong><%= hocvien.idLop.tenLop %></strong><br />
              Ng√†y khai gi·∫£ng:
              <strong
                ><%= getdate(hocvien.idLop.khaiGiang).split(' ')[1] %></strong
              ><br />
              Lo·∫°i b·∫±ng: <strong><%= hocvien.idLop.idLoaiBang.tenBang %></strong
              ><br />
            </address>
          </div>
          <div class="col-md-6">
            <div class="row">
              <address class="mt-2 mt-sm-0" style="padding-left:5%;">
                <strong>Th√¥ng tin gi·∫£ng vi√™n h∆∞·ªõng d·∫´n:</strong><br />
                L·ªõp: <strong><%= hocvien.idLop.idGiangVien.ten %></strong><br />
                Ng√†y khai gi·∫£ng:
                <strong><%= hocvien.idLop.idGiangVien.sdt %></strong><br />
                Lo·∫°i b·∫±ng:
                <strong><%= hocvien.idLop.idGiangVien.email %></strong><br />
              </address>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="card-body" style="padding-top: 0">
            <div class="">
              <strong
                >Th·ªùi gian h·ªçc (<%=total%> gi·ªù) / T·ªïng th·ªùi gian
                (<%=hocvien.idLop.idLoaiBang.thoiGianHoc%> gi·ªù) </strong
              ><br />
              <div class="progress">
                <div
                  class="progress-bar progress-bar-striped progress-bar-animated"
                  role="progressbar"
                  aria-valuenow=""
                  aria-valuemin="0"
                  aria-valuemax="100"
                  style="width: <%= (total * 100) / hocvien.idLop.idLoaiBang.thoiGianHoc %>%"
                ></div>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div style="height : 30vh; overflow-y : auto">
          <table id="tech-companies-1" class="table table-striped">
            <thead>
              <tr>
                <th
                  style="position: sticky; top : -1px ;background-color: white;"
                >
                  H·ªçc vi√™n
                </th>
                <th
                  style="position: sticky; top : -1px ;background-color: white;"
                >
                  Th·ªùi gian v√†o
                </th>
                <th
                  style="position: sticky; top : -1px  ;background-color: white;"
                >
                  Th·ªùi gian ra
                </th>
                <th
                  style="position: sticky; top : -1px ;background-color: white;"
                >
                  T·ªïng th·ªùi gian (s)
                </th>
                <th
                  style="position: sticky; top : -1px ;background-color: white;"
                >
                  ·∫¢nh l√∫c v√†o
                </th>
                <th
                  style="position: sticky; top : -1px ;background-color: white;"
                >
                  ·∫¢nh l√∫c ra
                </th>
              </tr>
            </thead>
            <tbody>
              <% for(item of log) {%>
              <tr>
                <th><span class="co-name"><%= hocvien.ten %></span></th>
                <td><%= getdate(item.checkInAt) %></td>
                <td><%= getdate(item.checkOutAt) %></td>
                <td><%= item.totalTime %></td>
                <td><a href="#"><%= item.imageCheckIn %></a></td>
                <td><a href="#"><%= item.imageCheckOut %></a></td>
              </tr>
              <% total+= item.totalTime; } %>
            </tbody>
          </table>
        </div>
        <% } %>

        <hr />
        <div class="d-print-none">
          <div class="float-right">
            <a
              href="javascript:window.print()"
              class="btn btn-success waves-effect waves-light mr-1"
              ><i class="fa fa-print"></i> In th√¥ng tin h·ªçc vi√™n</a
            >
            <a
              href="mailto: <%= hocvien.email %>"
              class="btn btn-primary w-md waves-effect waves-light"
              ><i class="far fa-paper-plane"></i> G·ª≠i email</a
            >
            <a
              href="call: <%= hocvien.sdt %>"
              class="btn btn-primary w-md waves-effect waves-light"
              ><i class="fas fa-phone-alt"></i> Li√™n h·ªá qua s·ªë ƒëi·ªán tho·∫°i</a
            >
            <% if(hocvien.pending) { %>
            <button
              data-toggle="modal"
              data-target=".bs-example-modal-center"
              class="btn btn-warning w-md waves-effect waves-light"
            >
              <i class="fas fa-calendar"></i> ƒê·∫∑t l·ªãch h·∫πn
            </button>
            <% }else{ %> <% if(hocvien.embedding != null) { %> <%
            if(hocvien.idLop == null) { %>
            <button
              data-toggle="modal"
              data-target=".bs-example-modal-center"
              class="btn btn-warning w-md waves-effect waves-light"
            >
              <i class="fas fa-qrcode"></i> X·∫øp l·ªõp
            </button>
            <% } %> <% } else { %>
            <button
              data-toggle="modal"
              data-target=".bs-example-modal-center"
              class="btn btn-warning w-md waves-effect waves-light"
            >
              <i class="fas fa-qrcode"></i> Nh·∫≠n m√£ QR
            </button>
            <% } %> <% }%>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<% if(hocvien.pending) { %>
<div
  class="modal fade bs-example-modal-center"
  tabindex="-1"
  role="dialog"
  aria-labelledby="mySmallModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title mt-0">ƒê·∫∑t l·ªãch h·∫πn cho <%= hocvien.ten %></h5>
        <input
          id="code"
          type="text"
          value="<%= hocvien._id %>"
          hidden
          readonly
        />
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <label for="appointment" class=" col-form-label">Ng√†y h·∫πn:</label>
        <input
          class="form-control"
          type="datetime-local"
          id="appointment"
          required
        />
        <label for="note" class=" col-form-label">Ghi ch√∫:</label>
        <textarea id="note" class="form-control" name="ghiChu"></textarea>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          id="btn-close"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          Close
        </button>
        <button type="button" id="datlich" class="btn btn-success">
          ƒê·∫∑t l·ªãch h·∫πn
        </button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- toastr plugin -->
<script src="\assets\libs\toastr\build\toastr.min.js"></script>

<script>
  $(document).ready(() => {
    $('#datlich').on('click', () => {
      $.ajax({
        url: '/api/v1/student/setappointment',
        type: 'post',
        data: {
          _id: $('#code').val(),
          ngayHen: $('#appointment').val(),
          ghiChu: $('#note').val()
        },
        success: function(data) {
          if (data === 'success') {
            $('#btn-close').click();
            toastr.options = {
              closeButton: false,
              debug: false,
              newestOnTop: false,
              progressBar: false,
              positionClass: 'toast-bottom-right',
              preventDuplicates: false,
              onclick: null,
              showDuration: 300,
              hideDuration: 1000,
              timeOut: 5000,
              extendedTimeOut: 1000,
              showEasing: 'swing',
              hideEasing: 'linear',
              showMethod: 'fadeIn',
              hideMethod: 'fadeOut'
            };
            toastr.options.onHidden = () => {
              location.reload();
            };
            toastr['success']('Yub! ƒê·∫∑t l·ªãch h·∫πn th√†nh c√¥ng ^^', 'Th√†nh c√¥ng!');
          } else {
            $('#btn-close').click();
            toastr.options = {
              closeButton: false,
              debug: false,
              newestOnTop: false,
              progressBar: false,
              positionClass: 'toast-bottom-right',
              preventDuplicates: false,
              onclick: null,
              showDuration: 300,
              hideDuration: 1000,
              timeOut: 5000,
              extendedTimeOut: 1000,
              showEasing: 'swing',
              hideEasing: 'linear',
              showMethod: 'fadeIn',
              hideMethod: 'fadeOut'
            };
            toastr.on.options.onHidden = () => {
              location.reload();
            };
            toastr['error'](
              'ƒê·∫∑t l·ªãch h·∫πn th·∫•t b·∫°i. Ki·ªÉm tra l·∫°i!',
              'Ops! Th·∫•t b·∫°i'
            );
          }
        }
      });
    });
  });
</script>
<% } else { %> <% if(hocvien.embedding != null) { %> <% if(hocvien.idLop ==
null) { %>
<div
  class="modal fade bs-example-modal-center"
  tabindex="-1"
  role="dialog"
  aria-labelledby="mySmallModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title mt-0">X·∫øp l·ªõp cho <%= hocvien.ten %></h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <input
          id="code"
          type="text"
          value="<%= hocvien._id %>"
          hidden
          readonly
        />
      </div>
      <div class="modal-body">
        <select class="form-control" id="lop">
          <option value="" selected disabled hidden>--Ch·ªçn l·ªõp--</option>
          <% for(item of lop) { %>
            <option value="<%= item._id %>" ><%= item.tenLop %></option>
          <% } %>
      </select>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          id="btn-close"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          Close
        </button>
        <button type="button" id="xeplop" class="btn btn-success">
          X√°c nh·∫≠n
        </button>
      </div>
    </div>
  </div>
</div>

<script src="\assets\libs\toastr\build\toastr.min.js"></script>

<script>
  $(document).ready(() => {
    $('#xeplop').on('click', () => {
      $.ajax({
        url: '/api/v1/student/xeplop',
        type: 'post',
        data: {
          _id: $('#code').val(),
          idLop: $('#lop').val(),
        },
        success: function(data) {
          if (data === 'success') {
            $('#btn-close').click();
            toastr.options = {
              closeButton: false,
              debug: false,
              newestOnTop: false,
              progressBar: false,
              positionClass: 'toast-bottom-right',
              preventDuplicates: false,
              onclick: null,
              showDuration: 300,
              hideDuration: 1000,
              timeOut: 5000,
              extendedTimeOut: 1000,
              showEasing: 'swing',
              hideEasing: 'linear',
              showMethod: 'fadeIn',
              hideMethod: 'fadeOut'
            };
            toastr.options.onHidden = () => {
              location.reload();
            };
            toastr['success']('Yub! ƒê·∫∑t l·ªãch h·∫πn th√†nh c√¥ng ^^', 'Th√†nh c√¥ng!');
          } else {
            $('#btn-close').click();
            toastr.options = {
              closeButton: false,
              debug: false,
              newestOnTop: false,
              progressBar: false,
              positionClass: 'toast-bottom-right',
              preventDuplicates: false,
              onclick: null,
              showDuration: 300,
              hideDuration: 1000,
              timeOut: 5000,
              extendedTimeOut: 1000,
              showEasing: 'swing',
              hideEasing: 'linear',
              showMethod: 'fadeIn',
              hideMethod: 'fadeOut'
            };
            toastr.on.options.onHidden = () => {
              location.reload();
            };
            toastr['error'](
              'ƒê·∫∑t l·ªãch h·∫πn th·∫•t b·∫°i. Ki·ªÉm tra l·∫°i!',
              'Ops! Th·∫•t b·∫°i'
            );
          }
        }
      });
    });
  });
</script>
<!-- /.modal -->
<% } %>
<% } else { %>
<div
  class="modal fade bs-example-modal-center"
  tabindex="-1"
  role="dialog"
  aria-labelledby="mySmallModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title mt-0">QR code c·ªßa <%= hocvien.ten %></h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <input
          id="code"
          type="text"
          value="<%= hocvien._id %>"
          hidden
          readonly
        />
      </div>
      <div class="modal-body">
        <div id="id_qrcode" style="margin-left: 30%"></div>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<script type="text/javascript" src="/js/qrcode.min.js"></script>
<script>
  window.onload = function(e) {
    var code = document.getElementById('code').value;
    var qrcode = new QRCode('id_qrcode', {
      text: code,
      width: 200,
      height: 200,
      colorDark: '#000000',
      colorLight: '#ffffff',
      correctLevel: QRCode.CorrectLevel.M
    });
  };
</script>
<% } %> <% } %>

<style>
  /* common */
  .ribbon {
    width: 150px;
    height: 150px;
    overflow: hidden;
    position: absolute;
  }
  .ribbon::before,
  .ribbon::after {
    position: absolute;
    z-index: -1;
    content: '';
    display: block;
    border: 5px solid #2980b9;
  }
  .ribbon span {
    position: absolute;
    display: block;
    width: 225px;
    padding: 15px 0;
    background-color: #3498db;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    color: #fff;
    font: 700 18px/1 'Lato', sans-serif;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    text-transform: uppercase;
    text-align: center;
  }

  .ribbon1 {
    width: 150px;
    height: 150px;
    overflow: hidden;
    position: absolute;
  }
  .ribbon1::before,
  .ribbon1::after {
    position: absolute;
    z-index: -1;
    content: '';
    display: block;
    border: 5px solid #105812;
  }
  .ribbon1 span {
    position: absolute;
    display: block;
    width: 225px;
    padding: 15px 0;
    background-color: #4caf50;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    color: #fff;
    font: 700 18px/1 'Lato', sans-serif;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    text-transform: uppercase;
    text-align: center;
  }

  .ribbon2 {
    width: 150px;
    height: 150px;
    overflow: hidden;
    position: absolute;
  }
  .ribbon2::before,
  .ribbon2::after {
    position: absolute;
    z-index: -1;
    content: '';
    display: block;
    border: 5px solid #6e640b;
  }
  .ribbon2 span {
    position: absolute;
    display: block;
    width: 225px;
    padding: 15px 0;
    background-color: #ffd752;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    color: #fff;
    font: 700 18px/1 'Lato', sans-serif;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    text-transform: uppercase;
    text-align: center;
  }

  /* top left*/
  .ribbon-top-left {
    top: -10px;
    left: -10px;
  }
  .ribbon-top-left::before,
  .ribbon-top-left::after {
    border-top-color: transparent;
    border-left-color: transparent;
  }
  .ribbon-top-left::before {
    top: 0;
    right: 0;
  }
  .ribbon-top-left::after {
    bottom: 0;
    left: 0;
  }
  .ribbon-top-left span {
    right: -25px;
    top: 30px;
    transform: rotate(-45deg);
  }
</style>
